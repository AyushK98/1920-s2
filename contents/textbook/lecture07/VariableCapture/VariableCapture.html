<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="MarkBind 2.13.0">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CS2030 AY19/20 Semester 2</title>
  <link rel="stylesheet" href="../../../../markbind/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../markbind/css/bootstrap-vue.min.css">
  <link rel="stylesheet" href="../../../../markbind/fontawesome/css/all.min.css">
  <link rel="stylesheet" href="../../../../markbind/glyphicons/css/bootstrap-glyphicons.min.css">
  <link rel="stylesheet" href="../../../../markbind/css/octicons.css">
  <link rel="stylesheet" href="../../../../markbind/css/github.min.css">
  <link rel="stylesheet" href="../../../../markbind/css/markbind.css">
  <link rel="stylesheet" href="../../../../markbind/layouts/default/styles.css">
  <link rel="stylesheet" href="../../../../markbind/css/page-nav.css">
</head>

<body data-spy="scroll" data-target="#page-nav" data-offset="100">
  <div id="app">
    <header>
      <navbar type="dark" class="temp-navbar">
        <a slot="brand" href="/1920-s2/index.html" title="Home" class="navbar-brand">CS2030 AY19/20 Semester 2</a>
        <div class="nav-link temp-dropdown-placeholder">Peer Learning</div>
        <dropdown class="nav-link temp-dropdown"><template slot="_header">Peer Learning</template>
          <li><a href="/1920-s2/contents/peerlearning/peerlearning.html" class="dropdown-item">Introduction</a></li>
          <li><a href="/1920-s2/contents/peerlearning/textbook.html" class="dropdown-item">Textbook Contributions</a></li>
          <li><a href="/1920-s2/contents/peerlearning/peerlearningtask.html" class="dropdown-item">Peer Learning Tasks</a></li>
          <li><a href="/1920-s2/contents/peerlearning/piazza.html" class="dropdown-item">Piazza Participation</a></li>
        </dropdown>
        <div class="nav-link temp-dropdown-placeholder">Guides</div>
        <dropdown class="nav-link temp-dropdown"><template slot="_header">Guides</template>
          <li><a href="/1920-s2/contents/guides/settingUpLabEnv.html" class="dropdown-item">Setting Up Lab Environment</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpJava.html" class="dropdown-item">Setting Up Java</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpVim.html" class="dropdown-item">Setting Up Vim</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpMacVim.html" class="dropdown-item">Setting Up MacVim</a></li>
          <li><a href="/1920-s2/contents/guides/sunfireLabs.html" class="dropdown-item">Setting Up Sunfire and PE Nodes</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpCheckstyle.html" class="dropdown-item">Setting Up Checkstyle</a></li>
        </dropdown>
        <li><a slot="brand" href="/1920-s2/contents/textbook/textbook.html" class="nav-link">Textbook</a></li>
        <div class="nav-link temp-dropdown-placeholder">Links</div>
        <dropdown class="nav-link temp-dropdown"><template slot="_header">Links</template>
          <li><a href="https://www.comp.nus.edu.sg/~cs2030/style/" class="dropdown-item" target="_blank">CS2030 Java Style Guide</a></li>
          <li><a href="https://www.comp.nus.edu.sg/~cs2030/javadoc/" class="dropdown-item" target="_blank">CS2030 Javadoc Specification</a></li>
          <li><a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html" class="dropdown-item" target="_blank">JDK 11 Download Link</a></li>
          <li><a href="https://codecrunch.comp.nus.edu.sg/" class="dropdown-item" target="_blank">Codecrunch</a></li>
          <li><a href="https://github.com/nus-cs2030/1920-s2" class="dropdown-item" target="_blank">Github Repo</a></li>
          <li><a href="https://piazza.com/class/k54zo22zq1t2zc" class="dropdown-item" target="_blank">Piazza Forum</a></li>
        </dropdown>
        <li slot="right">
          <form class="navbar-form">
            <searchbar :data="searchData" placeholder="Search" :on-hit="searchCallback" menu-align-right></searchbar>
          </form>
        </li>
      </navbar>
    </header>
    <div id="flex-body">
      <div id="content-wrapper">
        <br>
        <h1 id="variable-capture">Variable Capture<a class="fa fa-anchor" href="#variable-capture"></a></h1>
        <br>

        <p><a href="https://github.com/nus-cs2030/1920-s2/edit/master/contents/textbook/lecture07/VariableCapture/VariableCapture.md">Edit the material here! <span aria-hidden="true" class="fas fa-pen"></span></a></p>

        <p>For classes that are defined within a method, variable capturing will occur. Variable capture is when the local variables within the local function in which the nested class is defined is being captured inside of the instance of the inner class
          in the heap. Looking at the code from Recitation 6 Q2,</p>
        <pre><code class="hljs java"><span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>{</span><span>  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> </span>{</span><span>    <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;</span><span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{</span><span>      <span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>;</span><span>      A() {</span><span>        y = x + <span class="hljs-number">1</span>;</span><span>      }</span><span>    }</span><span>    A a = <span class="hljs-keyword">new</span> A();</span><span>  }</span><span>}</span></code></pre>
        <p>In this example, the variable int x is defined in the enclosing function in which the class A is defined. This means that the variable x is a local variable, and will be captured inside every instance of A in the heap, even if not explicitly declared
          in A. This means that methods in class A will be able to make use of the variable x.</p>
        <h2 id="effectively-final">Effectively final<a class="fa fa-anchor" href="#effectively-final"></a></h2>
        <p>From java 8, local variables that are captured must be final or effectively final. In the example above, this means that x must be final or effectively final. Since variable x is captured by A, trying to change the value of x will result in a
          compilation error.
        </p>
        <pre><code class="hljs java"><span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>{</span><span>  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> </span>{</span><span>    <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;</span><span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{</span><span>      <span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>;</span><span>      A() {</span><span>        y = x + <span class="hljs-number">1</span>;</span><span>      }</span><span>    }</span><span>    x = <span class="hljs-number">1</span>; <span class="hljs-comment">//results in an error</span></span><span>    A a = <span class="hljs-keyword">new</span> A();</span><span>  }</span><span>}</span></code></pre>
        <p>Somewhere that we often see this phenomenon is in lamba expressions. Like inner classes, lambda expressions also captures local variables, which is why when we use a lambda expression inside a method, we can reference the variables that are defined
          in the enclosing method within our lambda expression. Since local variables are captured by lambda expressions, this means that those captured variables must also be final or effectively final. For example,</p>
        <pre><code class="hljs java"><span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>{</span><span>  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">supplierAdd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{</span><span>    Supplier&lt;Integer&gt; s = () -&gt; x + y; <span class="hljs-comment">//variables x and y are captured by lambda</span></span><span>    x++; <span class="hljs-comment">//this results in a compilation error</span></span><span>    <span class="hljs-keyword">return</span> s.get()</span><span>  }</span><span>}</span></code></pre>
      </div>
      <nav id="page-nav" class="navbar navbar-light bg-transparent">
        <div class="border-left-grey nav-inner position-sticky slim-scroll">

          <nav class="nav nav-pills flex-column my-0 small no-flex-wrap">
            <a class="nav-link py-1" href="#variable-capture">Variable Capture&#x200E;</a>
            <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap">
              <a class="nav-link py-1" href="#effectively-final">Effectively final&#x200E;</a>
            </nav>

          </nav>
        </div>
      </nav>
    </div>
    <footer>

      <div class="text-center">
        <small>Generated by <a href="https://markbind.org/">MarkBind 2.13.0</a> on Mon, Mar 30, 2020, 2:18:40 PM UTC</small></div>
    </footer>
  </div>
</body>
<script src="../../../../markbind/js/vue.min.js"></script>
<script src="../../../../markbind/js/vue-strap.min.js"></script>
<script src="../../../../markbind/js/bootstrap-utility.min.js"></script>
<script src="../../../../markbind/js/polyfill.min.js"></script>
<script src="../../../../markbind/js/bootstrap-vue.min.js"></script>
<script>
  const baseUrl = '/1920-s2'
  const enableSearch = true
</script>
<script src="../../../../markbind/js/setup.js"></script>
<script src="../../../../markbind/layouts/default/scripts.js"></script>

</html>